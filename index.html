<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø§Ù†ØªØ®Ø§Ø¨Ø§Øª 2025</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@600;800&display=swap" rel="stylesheet">
<style>
* {margin: 0; padding: 0; box-sizing: border-box;}
body {
    font-family: 'Cairo', Tahoma, Arial, sans-serif;
    background: linear-gradient(135deg,#eeffee 0%,#bbcaf9 100%);
    margin:0;
    padding:24px;
    min-height:100vh;
}
.container {
    max-width:1000px;
    margin:auto;
    background:rgba(255,255,255,0.93);
    padding:32px 20px 30px 20px;
    border-radius:24px;
    box-shadow:0 10px 32px 2px rgba(30,60,170,0.13),0 1.5px 22px 0 rgba(0,0,0,0.06);
    animation: fadein 1.2s;
}
@keyframes fadein {
    0%{transform:scale(0.93) translateY(24px); opacity:0;}
    100%{transform:scale(1) translateY(0);}
}
h1 {
    text-align:center;
    margin-bottom:5px;
    color: #1976d2;
    letter-spacing:2px;
    font-size:clamp(32px, 8vw, 42px);
    background: linear-gradient(95deg,#2adfc4 30%,#0099ff 80%);
    background-clip: text;
    -webkit-background-clip: text;
    color: transparent;
    -webkit-text-fill-color: transparent;
    text-shadow: 0 6px 32px #00dbe24c;
}
.subtitle {
    text-align:center;
    color:#166;
    margin-bottom:24px;
    font-size:clamp(16px, 5vw, 20px);
    font-weight:500;
    letter-spacing:.1em;
    text-shadow:0 1px 0 #fff,0 4px 20px #35d7dd19;
}
.search-box {
    width:99%;
    max-width:480px;
    margin:22px auto 0 auto;
    display:block;
    padding:18px;
    font-size:clamp(16px, 4vw, 25px);
    border-radius:50px;
    border:2.5px solid #19bcc4;
    text-align:center;
    box-shadow:0 0 12px #1ee7ad2c;
    margin-bottom: 10px;
    background:rgba(245,255,255,0.89);
}
.results {
    margin-top:26px;
    max-height:500px;
    overflow-y:auto;
    min-height:40px;
}
.voter-item {
    background:linear-gradient(95deg,#fff 86%,#e1f8f4 100%);
    padding:19px 16px;
    border-right:7px solid #27e88b;
    border-radius:19px;
    margin:14px 0;
    box-shadow:0 3px 15px #1bc98221;
    cursor:pointer;
    transition:.23s;
    overflow:hidden;
    animation:faderes .7s cubic-bezier(.4,1.64,.41,.8);
}
@keyframes faderes {
    0%{opacity:0;transform:scale(.95) translateY(18px);}
    70%{opacity:1;}
    100%{transform:scale(1) translateY(0);}
}
.voter-item:hover {
    background:linear-gradient(90deg,#eefff0 50%,#ddf2ff 100%);
    border-right:8px solid #00dcff;
    transform: scale(1.031) translateX(-4px);
    box-shadow:0 9px 30px #3eecf348;
}
.voter-name {
    font-size:clamp(18px, 4vw, 23px);
    font-weight:bold;
    color:#1a3f58;
}
.voter-serial {
    font-size:clamp(20px, 5vw, 27px);
    font-weight:900;
    color:#e50c41;
    padding-top:4px;
    letter-spacing:2px;
}
.mic-section {
    text-align:center;
    margin:20px 0 30px 0;
}
#micBtn {
    font-size:clamp(24px, 8vw, 28px);
    border:none;
    border-radius:50%;
    background:linear-gradient(140deg,#ffe568 50%,#01eaea 100%);
    color:#1877f2;
    padding:clamp(15px, 5vw, 20px);
    cursor:pointer;
    box-shadow:0 6px 20px #3eccec77, 0 2px 10px #fffad2;
    position:relative;
    outline:none;
    margin:auto;
    transition:box-shadow .22s,background .2s;
    width: clamp(60px, 12vw, 80px);
    height: clamp(60px, 12vw, 80px);
    display: flex;
    align-items: center;
    justify-content: center;
}
#micBtn.active {
    background:linear-gradient(90deg,#00d6d3 50%,#49fd68 100%);
    color:#222;
}
#micStatus {
    margin-right:16px;
    color:#009e62;
    font-size:clamp(16px, 4vw, 21px);
    font-weight:700;
    letter-spacing:1.5px;
}
#floatingInputBtn {
    position: fixed;
    top: 70px;
    left: 20px;
    z-index: 9999;
    background:linear-gradient(125deg,#1877f2 40%,#21d0ff 100%);
    color: white;
    border: none;
    border-radius: 54%;
    width: clamp(50px, 10vw, 60px);
    height: clamp(50px, 10vw, 60px);
    font-size: clamp(24px, 6vw, 32px);
    box-shadow:0 8px 27px #077de838, 0 2px 6px #fff;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition:.24s cubic-bezier(.3,.8,.3,1.25);
    outline: none;
}
#floatingInputBtn:hover {
    background:linear-gradient(95deg,#0cadf5 20%,#08dfc3 99%);
}
#dataStatusDot {
    position: absolute;
    top: 11px;
    left: 11px;
    width: 13px;
    height: 13px;
    border-radius: 50%;
    background: #fb5858;
    border:2.5px solid #fff;
    display: block;
    z-index: 2;
    transition:.22s;
}
#dataStatusDot.full {
    background:#18e14a;
}
#inputModal {
    display: none;
    position: fixed;
    left:0;
    top:0;
    width:100vw;
    height:100vh;
    background: rgba(18,58,73,.14);
    z-index:10001;
    align-items: center;
    justify-content: center;
}
#inputModalBox {
    background: linear-gradient(110deg,#ffffff 70%,#d3faff 100%);
    padding: clamp(20px, 5vw, 28px) clamp(15px, 4vw, 18px) 10px clamp(15px, 4vw, 18px);
    border-radius: 13px;
    max-width:430px;
    min-width:265px;
    width:96vw;
    box-shadow:0 3px 30px #1fd7f130;
    display: flex;
    flex-direction: column;
    align-items: center;
    animation: fadein .61s cubic-bezier(.41,1.14,.77,1);
}
#inputModalBox textarea {
    width:100%;
    min-height:180px;
    border-radius:8px;
    border:2.3px solid #35b8dc;
    font-size:clamp(14px, 3vw, 16px);
    margin-bottom:16px;
    padding:12px;
}
#inputModalBox button {
    background: linear-gradient(93deg,#1dc5ff 60%,#11db94 100%);
    color: white;
    border:none;
    font-size:clamp(14px, 3vw, 18px);
    padding:10px 23px;
    border-radius:9px;
    margin:6px 2px;
    cursor:pointer;
    margin-bottom:3px;
    transition:.15s;
}
#inputModalBox button:hover {
    background:linear-gradient(85deg,#1da0d8 60%,#25dbd4 100%);
}
#inputModalBox button#modalClose {
    background:#d32f2f;
}
#inputModalBox button#modalClose:hover {
    background:#d3052f;
}
.modal {
    display:none;
    position:fixed;
    left:0;
    top:0;
    width:100%;
    height:100%;
    background:rgba(30,43,58,0.92);
    z-index:10000;
    justify-content:center;
    align-items:center;
}
.card {
    width:clamp(300px, 90vw, 370px);
    background:linear-gradient(113deg,#fff 75%,#22b9e5 160%);
    border-radius:25px;
    overflow:hidden;
    box-shadow:0 22px 44px #2d7ff74a,0 2px 4px #fff;
    margin:0 auto;
    display:flex;
    flex-direction:column;
    align-items:center;
    position:relative;
}
.card-header {
    color:#1976d2;
    padding:clamp(20px, 5vw, 30px) clamp(12px, 3vw, 18px) 12px clamp(12px, 3vw, 18px);
    text-align:center;
    font-size:clamp(24px, 6vw, 33px);
    font-weight:900;
    width:98%;
    word-break: break-word;
    line-height:1.45;
    letter-spacing:.6px;
    border-right:10px solid #12bee7;
    background:linear-gradient(97deg,#fff 60%,#d3faff 120%);
    margin-bottom:0;
    border-radius:16px 0 20px 0;
    box-shadow:0 1.5px 10px #21badc23;
}
.big-serial {
    font-size:clamp(40px, 10vw, 54px);
    font-weight:900;
    color:#dc143c;
    border-right:9px solid #f55151;
    background:linear-gradient(87deg,#fff 70%,#ffe4e4 110%);
    padding:clamp(20px, 5vw, 26px) 0 clamp(20px, 5vw, 23px) 0;
    border-radius:17px;
    margin:17px 0 19px 0;
    letter-spacing:3px;
    text-align:center;
    width: 85%;
    text-shadow:0 2px 8px #f55151a6;
    box-shadow:0 2px 20px #21badc31,0 2px 14px #ffadad08;
}
.print-btn {
    background:linear-gradient(90deg,#e7233c 70%,#ff8b8b 100%);
    color:white;
    border:none;
    width:82%;
    padding:clamp(12px, 3vw, 16px);
    margin:clamp(15px, 4vw, 18px) auto 18px auto;
    border-radius:40px;
    font-size:clamp(20px, 5vw, 27px);
    cursor:pointer;
    box-shadow:0 3px 18px #d32f2f22;
    font-weight:800;
    transition:.13s;
}
.print-btn:hover {
    background:linear-gradient(90deg,#f85737 60%,#ffdadd 120%);
    color:#dc143c;
}
.close-btn {
    position:absolute;
    left:13px;
    top:13px;
    font-size:clamp(20px, 5vw, 28px);
    background:linear-gradient(120deg,#ee8899 30%,#ffeded 160%);
    color:#b31c2d;
    border:none;
    border-radius:24px;
    padding:5px 17px 2px 17px;
    cursor:pointer;
    font-weight:800;
    transition: 0.18s;
    box-shadow:0 2px 7px #fbc6c6ab;
}
.close-btn:hover {
    background:#ffdddd;
    color:#7a0512;
}
.credit {
    margin-top:36px;
    text-align:center;
    color:#777;
    font-size:clamp(14px, 3vw, 18px);
}
.credit a {
    color:#1877f2;
    font-weight:bold;
    text-decoration:none;
    transition:.15s;
}
.credit a:hover {
    text-decoration: underline;
}
@media print {
    body * {visibility:hidden;}
    #printArea, #printArea * {visibility:visible;}
    #printArea {
        position:absolute;
        left:0;top:0;
        width:5cm;height:2.5cm;
        background:white;
        padding-top:0.6cm;
        text-align:center;
        border:1px solid #000;
    }
    @page {size: 5cm 2.5cm;margin:0;}
}
::-webkit-scrollbar{height:9px;width:7px;background:#eee;}
::-webkit-scrollbar-thumb{background:#10c1e7;border-radius:7px;}
</style>
</head>
<body>
<div class="container">
    <h1>Ø§Ù†ØªØ®Ø§Ø¨Ø§Øª 2025</h1>
    <p class="subtitle">Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„ØµÙˆØª Ø£Ùˆ Ø£Ø¯Ø®Ù„ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù†Ø§Ø®Ø¨ÙŠÙ† - Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙÙˆØ±ÙŠØ§Ù‹</p>
    <div class="mic-section">
        <button id="micBtn" title="Ø¨Ø­Ø« ØµÙˆØªÙŠ">ğŸ¤</button>
        <span id="micStatus"></span>
    </div>
    <input type="text" id="searchBox" class="search-box" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø±Ù‚Ù…..." onkeyup="search()">
    <div id="results" class="results"></div>
    <div class="credit">
        ØªÙ… Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„Ø£Ø¯Ø§Ø© Ø¨ÙƒÙ„ Ø­Ø¨ Ù…Ù† Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³
        <a href="https://www.facebook.com/en.mohamed.nasr" target="_blank">Ù…Ø­Ù…Ø¯ Ø­Ù…Ø§Ø¯</a>
    </div>
</div>
<button id="floatingInputBtn" title="Ø¥Ø¯Ø®Ø§Ù„ Ø£Ùˆ ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª">ğŸ“‹<span id="dataStatusDot"></span></button>
<div id="inputModal">
    <div id="inputModalBox">
        <h3 style="color:#1976d2;margin-bottom:8px;text-align:center;font-size:clamp(20px, 5vw, 25px);">Ø¥Ø¯Ø®Ø§Ù„/ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø§Ø®Ø¨ÙŠÙ†</h3>
        <textarea id="textInput" placeholder="Ù…Ø«Ø§Ù„: Ù¡ Ø§Ø¨ØªØ³Ø§Ù… ... Ù¢ Ø§Ø¨ØªØ³Ø§Ù… ... Ù£ ... ÙÙŠ Ù†ÙØ³ Ø§Ù„Ø³Ø·Ø± Ø£Ùˆ Ø³Ø·ÙˆØ± Ù…ØªØ¹Ø¯Ø¯Ø©"></textarea>
        <div style="display:flex;gap:10px;flex-wrap:wrap;justify-content:center;">
            <button onclick="loadData()">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            <button onclick="getFromUrl()">Ø¬Ù„Ø¨ Ù…Ù† Ø±Ø§Ø¨Ø·</button>
            <button id="modalClose">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
        <div style="color:#b99;font-size:clamp(11px,2.5vw,12px);margin-top:12px;text-align:center;">
            ÙŠÙ…ÙƒÙ†Ùƒ Ù„ØµÙ‚ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙŠØ¯ÙˆÙŠÙ‹Ø§ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø²Ø± Ù„Ø¬Ù„Ø¨Ù‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø£ÙŠ Ø±Ø§Ø¨Ø· txt.
        </div>
    </div>
</div>
<div id="modal" class="modal" onclick="this.style.display='none'">
    <div class="card" onclick="event.stopPropagation()">
        <button class="close-btn" onclick="document.getElementById('modal').style.display='none';" title="Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©">Ã—</button>
        <div class="card-header" id="modalName"></div>
        <div class="big-serial" id="modalSerial"></div>
        <button class="print-btn" onclick="printCard()">Ø·Ø¨Ø§Ø¹Ø©</button>
    </div>
</div>
<div id="printArea" style="display:none;">
    <div id="pSerialOnly" style="font-size:28px;font-weight:bold;text-align:center;margin-top:4px;"></div>
</div>
<script>
const AUTOLOAD_URL = "https://raw.githubusercontent.com/mohamednasr5/ahm/refs/heads/main/00.txt";
window.addEventListener('DOMContentLoaded', () => {
    fetch(AUTOLOAD_URL)
        .then(r => r.ok ? r.text() : Promise.reject())
        .then(text => {
            document.getElementById('textInput').value = text.trim();
            loadData();
            updateDotStatus();
        })
        .catch(() => console.log("Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹"));
});
let voters = [];
const floatingInputBtn = document.getElementById('floatingInputBtn');
const inputModal = document.getElementById('inputModal');
const modalCloseBtn = document.getElementById('modalClose');
const textInput = document.getElementById('textInput');
const dataStatusDot = document.getElementById('dataStatusDot');
const searchBox = document.getElementById('searchBox');
const results = document.getElementById('results');
const micBtn = document.getElementById('micBtn');
const micStatus = document.getElementById('micStatus');
function updateDotStatus() {
    if (textInput.value.trim()) dataStatusDot.classList.add('full');
    else dataStatusDot.classList.remove('full');
}
floatingInputBtn.onclick = () => {
    inputModal.style.display = 'flex';
    updateDotStatus();
};
modalCloseBtn.onclick = () => inputModal.style.display = 'none';
inputModal.addEventListener('click', e => {
    if (e.target === inputModal) inputModal.style.display='none';
});
textInput.addEventListener('input', updateDotStatus);
function getFromUrl() {
    let url = prompt("Ø¶Ø¹ Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù„Ù Ø£Ùˆ Ø§Ù„Ù†Øµ Ù‡Ù†Ø§:");
    if (!url) return;
    fetch(url)
        .then(r => r.ok ? r.text() : Promise.reject())
        .then(text => {
            textInput.value = text.trim();
            updateDotStatus();
            alert("ØªÙ… Ø¬Ù„Ø¨ Ø§Ù„Ù†Øµ Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.");
        })
        .catch(() => alert("ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø§Ù„Ù†Øµ Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·."));
}
function fixNumbers(str) {
    const map = {"Ù ":"0","Ù¡":"1","Ù¢":"2","Ù£":"3","Ù¤":"4","Ù¥":"5","Ù¦":"6","Ù§":"7","Ù¨":"8","Ù©":"9"};
    return str.replace(/[Ù -Ù©]/g, d => map[d]);
}
function normalizeName(str) {
    // ØªÙˆØ­ÙŠØ¯ ÙŠ Ùˆ Ù‰ØŒ ÙˆØ¥Ø²Ø§Ù„Ø© Ø§Ù„ÙØ±Ø§ØºØ§Øª Ø§Ù„Ø²Ø§Ø¦Ø¯Ø©
    str = str.replace(/[ÙŠÙ‰]/g, "Ù‰").replace(/\s+/g, " ").trim();
    // Ø¯Ù…Ø¬ Ø¹Ø¨Ø¯ ÙˆØ§Ø³Ù… Ø¨Ø¹Ø¯Ù‡ (Ø£ÙŠ "Ø¹Ø¨Ø¯ Ø§Ù„ÙˆÙ‡Ø§Ø¨" ØªØµØ¨Ø­ "Ø¹Ø¨Ø¯Ø§Ù„ÙˆÙ‡Ø§Ø¨" Ù„Ù„Ø¨Ø­Ø«)
    str = str.replace(/Ø¹Ø¨Ø¯\s+/g, 'Ø¹Ø¨Ø¯');
    return str;
}
function extractNumberName(line) {
    line = fixNumbers(line).trim();
    if (!line) return [];
    if (line.includes("Ù…Ø³Ù„Ø³Ù„ Ø§Ù„Ø³Ù…")) return [];
    if (/^\d+\s+Ù…Ù†\s+\d+/.test(line)) return [];
    if (line.includes("Ø±Ù‚Ù… Ø§Ù„Ù„Ø¬Ù†Ø©")) return [];
    let regex = /(\d{1,5})\s+([\u0600-\u06FF]+(?:\s+[\u0600-\u06FF]+)*)(?=\s+\d{1,5}\b|$)/g;
    let matches = [...line.matchAll(regex)];
    if (!matches.length) return [];
    return matches.map(m => ({
        number: m[1],
        name: m[2].trim()
    }));
}
function loadData() {
    const text = textInput.value.trim();
    if (!text) {
        alert("Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Øµ Ø£ÙˆÙ„Ø§Ù‹!");
        updateDotStatus();
        return;
    }
    voters = [];
    const lines = text.split(/\n/);
    lines.forEach(line => {
        const recs = extractNumberName(line);
        if (recs.length) voters.push(...recs);
    });
    alert("ØªÙ… ØªØ­Ù…ÙŠÙ„ " + voters.length + " Ù†Ø§Ø®Ø¨.");
    inputModal.style.display = 'none';
    setTimeout(() => searchBox.focus(), 200);
    search();
    updateDotStatus();
}
let levCache = {};
function levenshtein(a, b) {
    a = a || "";
    b = b || "";
    let key = a + "|" + b;
    if (levCache[key] !== undefined) return levCache[key];
    const m = a.length, n = b.length;
    if (!m) return n;
    if (!n) return m;
    let v0 = new Array(n + 1);
    let v1 = new Array(n + 1);
    for (let i = 0; i <= n; i++) v0[i] = i;
    for (let i = 0; i < m; i++) {
        v1[0] = i + 1;
        for (let j = 0; j < n; j++) {
            v1[j + 1] = Math.min(
                v1[j] + 1,
                v0[j + 1] + 1,
                v0[j] + (a[i] === b[j] ? 0 : 1)
            );
        }
        let t = v0; v0 = v1; v1 = t;
    }
    levCache[key] = v0[n];
    return v0[n];
}
function correctName(searchText, originalName) {
    const searchWords = normalizeName(searchText).split(" ").filter(Boolean);
    const originalWords = normalizeName(originalName).split(" ").filter(Boolean);
    let corrected = [];
    let usedIndices = new Set();
    for (let ow of originalWords) {
        let best = ow; let bestScore = 3; let bestIdx = -1;
        for (let i = 0; i < searchWords.length; i++) {
            if (usedIndices.has(i)) continue;
            let sw = searchWords[i];
            let dist = levenshtein(sw, ow);
            if (dist < bestScore) {
                bestScore = dist;
                best = sw; bestIdx = i;
            }
        }
        if (bestIdx !== -1 && bestScore <= 1) {
            corrected.push(best);
            usedIndices.add(bestIdx);
        } else {
            corrected.push(ow);
        }
    }
    for (let i = 0; i < searchWords.length; i++) {
        if (!usedIndices.has(i)) {corrected.push(searchWords[i]);}
    }
    return corrected.join(" ");
}
function smartMatch(q, name) {
    if (name.includes(q)) return true;
    const qWords = q.split(" ");
    const nWords = name.split(" ");
    let matchCount = 0;
    for (let qw of qWords) {
        for (let nw of nWords) {
            if (levenshtein(qw, nw) <= 1) {
                matchCount++;
                break;
            }
        }
    }
    // ÙŠÙƒÙÙŠ Ù„Ùˆ 60% Ù…Ù† ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¨Ø­Ø« ÙˆØ¬Ø¯Øª ØªØ´Ø§Ø¨Ù‡
    return matchCount >= Math.max(1, Math.floor(qWords.length * 0.6));
}
function search() {
    let q = searchBox.value.trim();
    results.innerHTML = "";
    if (!q) return;
    const normQ = normalizeName(q);
    let html = "";
    let out = [];
    for (let v of voters) {
        const n = normalizeName(v.name);
        if (n.includes(normQ) || smartMatch(normQ, n) || smartMatch(n, normQ)) {
            let score = levenshtein(normQ, n.slice(0, normQ.length));
            out.push({ v, score });
        }
    }
    out.sort((a, b) => a.score - b.score)
       .slice(0, 20)
       .forEach(o => {
            let v = o.v;
            let escapedName = v.name.replace(/'/g, "\\'");
            let escapedQuery = q.replace(/'/g, "\\'");
            html += `
            <div class="voter-item"
                 onclick="showCardWithName('${v.number}', '${escapedName}', '${escapedQuery}')">
                <div class="voter-name">${v.name}</div>
                <div class="voter-serial">Ø±Ù‚Ù… Ø§Ù„ÙƒØ´Ù: ${v.number}</div>
            </div>
            `;
        });
    results.innerHTML = html;
}
function showCardWithName(number, originalName, searchQuery) {
    let displayName = correctName(searchQuery, originalName);
    document.getElementById("modalName").textContent = displayName;
    document.getElementById("modalSerial").textContent = number;
    document.getElementById("pSerialOnly").textContent = number;
    document.getElementById("modal").style.display = "flex";
    speakNumber(number);
}
function printCard() {window.print();}

// Ø¯Ø§Ù„Ø© ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø±Ù‚Ù… Ø¥Ù„Ù‰ Ù†Øµ Ø¹Ø±Ø¨ÙŠ ØµØ­ÙŠØ­
function numberToArabic(num) {
    const ones = ["", "ÙˆØ§Ø­Ø¯", "Ø§Ø«Ù†Ø§Ù†", "Ø«Ù„Ø§Ø«Ø©", "Ø£Ø±Ø¨Ø¹Ø©", "Ø®Ù…Ø³Ø©", "Ø³ØªØ©", "Ø³Ø¨Ø¹Ø©", "Ø«Ù…Ø§Ù†ÙŠØ©", "ØªØ³Ø¹Ø©"];
    const teens = ["Ø¹Ø´Ø±Ø©", "Ø£Ø­Ø¯ Ø¹Ø´Ø±", "Ø§Ø«Ù†Ø§ Ø¹Ø´Ø±", "Ø«Ù„Ø§Ø«Ø© Ø¹Ø´Ø±", "Ø£Ø±Ø¨Ø¹Ø© Ø¹Ø´Ø±", "Ø®Ù…Ø³Ø© Ø¹Ø´Ø±", "Ø³ØªØ© Ø¹Ø´Ø±", "Ø³Ø¨Ø¹Ø© Ø¹Ø´Ø±", "Ø«Ù…Ø§Ù†ÙŠØ© Ø¹Ø´Ø±", "ØªØ³Ø¹Ø© Ø¹Ø´Ø±"];
    const tens = ["", "", "Ø¹Ø´Ø±ÙˆÙ†", "Ø«Ù„Ø§Ø«ÙˆÙ†", "Ø£Ø±Ø¨Ø¹ÙˆÙ†", "Ø®Ù…Ø³ÙˆÙ†", "Ø³ØªÙˆÙ†", "Ø³Ø¨Ø¹ÙˆÙ†", "Ø«Ù…Ø§Ù†ÙˆÙ†", "ØªØ³Ø¹ÙˆÙ†"];
    const hundreds = ["", "Ù…Ø§Ø¦Ø©", "Ù…Ø§Ø¦ØªØ§Ù†", "Ø«Ù„Ø§Ø«Ù…Ø§Ø¦Ø©", "Ø£Ø±Ø¨Ø¹Ù…Ø§Ø¦Ø©", "Ø®Ù…Ø³Ù…Ø§Ø¦Ø©", "Ø³ØªÙ…Ø§Ø¦Ø©", "Ø³Ø¨Ø¹Ù…Ø§Ø¦Ø©", "Ø«Ù…Ø§Ù†Ù…Ø§Ø¦Ø©", "ØªØ³Ø¹Ù…Ø§Ø¦Ø©"];
    num = parseInt(num);
    if (num === 0) return "ØµÙØ±";
    let result = "";
    if (num >= 100) {
        result += hundreds[Math.floor(num / 100)];
        num %= 100;
        if (num > 0) result += " Ùˆ";
    }
    if (num >= 20) {
        result += tens[Math.floor(num / 10)];
        num %= 10;
        if (num > 0) result += " Ùˆ";
    } else if (num >= 10) {
        result += teens[num - 10];
        num = 0;
    }
    if (num > 0) result += ones[num];
    return result;
}

// Ù†Ø·Ù‚ Ø§Ù„Ø±Ù‚Ù… Ø¨ØµÙˆØª Ø¹Ø±Ø¨ÙŠ ØµØ­ÙŠØ­ (ÙŠØ®ØªØ§Ø± Ø£ÙØ¶Ù„ ØµÙˆØª Ø¹Ø±Ø¨ÙŠ Ù…ØªØ§Ø­)
function speakNumber(num) {
    if ('speechSynthesis' in window) {
        const txt = numberToArabic(num);
        let utter = new SpeechSynthesisUtterance(txt);
        utter.lang = 'ar-SA'; // ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ¬Ø±Ø¨Ø© Ø¨Ù€ ar-EG Ø£Ùˆ ar Ø­Ø³Ø¨ Ø§Ù„Ù…ØªØµÙØ­
        let voices = speechSynthesis.getVoices();
        let voice = voices.find(v => v.lang && v.lang.startsWith('ar'));
        if(voice) utter.voice = voice;
        utter.rate = 1;
        utter.pitch = 1;
        speechSynthesis.cancel();
        speechSynthesis.speak(utter);
    }
}
// ØªØ­Ù…ÙŠÙ„ Ø£ØµÙˆØ§Øª Ø§Ù„Ù…ØªØµÙØ­ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„ØªØ´ØºÙŠÙ„ (Ù…Ø·Ù„ÙˆØ¨ Ù„Ù„Ù…ØªØµÙØ­Ø§Øª Ø§Ù„Ø­Ø¯ÙŠØ«Ø©)
window.speechSynthesis.onvoiceschanged = () => {};

let recognition;
let micActive = false;
let silenceTimeout;
let speechBuffer = "";
const SILENCE_DURATION = 700;
try {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    recognition = new SpeechRecognition();
    recognition.lang = 'ar-EG';
    recognition.continuous = true;
    recognition.interimResults = false;
    recognition.onstart = () => {
        micActive = true;
        speechBuffer = "";
        micBtn.classList.add('active');
        micStatus.textContent = "ÙŠØ³ØªÙ…Ø¹...";
        searchBox.value = "";
        results.innerHTML = "";
        clearTimeout(silenceTimeout);
    };
    recognition.onresult = e => {
        for (let i = e.resultIndex; i < e.results.length; i++) {
            if (e.results[i].isFinal) {
                speechBuffer += e.results[i][0].transcript.trim() + " ";
            }
        }
        clearTimeout(silenceTimeout);
        silenceTimeout = setTimeout(() => {
            if (micActive && speechBuffer.trim()) {
                recognition.stop();
                micActive = false;
                micBtn.classList.remove('active');
                micStatus.textContent = "";
                searchBox.value = speechBuffer.trim();
                search();
            }
        }, SILENCE_DURATION);
    };
    recognition.onerror = e => {
        micActive = false;
        micBtn.classList.remove('active');
        if (e.error === "no-speech")
            micStatus.textContent = "âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØª";
        else
            micStatus.textContent = "âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹";
    };
    recognition.onend = () => {
        micActive = false;
        micBtn.classList.remove('active');
    };
    micBtn.onclick = () => {
        if (!micActive) {
            try { recognition.start(); } catch(err) { console.error("Ø®Ø·Ø£ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ¹Ø±Ù Ø§Ù„ØµÙˆØªÙŠ:", err); }
        } else {
            recognition.stop();
        }
    };
} catch (e) {
    micStatus.textContent = "ğŸ¤ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…";
    console.error("Ø§Ù„ØªØ¹Ø±Ù Ø§Ù„ØµÙˆØªÙŠ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…:", e);
}
</script>
</body>
</html>
