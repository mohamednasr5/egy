<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>انتخابات 2025</title>

<style>
/* ——————————————————————————————————————
             التصميم الأصلي (محفوظ بالكامل)
—————————————————————————————————————— */
body {
    font-family: 'Cairo', Tahoma, Arial, sans-serif;
    background: linear-gradient(135deg,#eeffee 0%,#bbcaf9 100%);
    margin:0;
    padding:24px;
    min-height:100vh;
}
.container {
    max-width:1000px; margin:auto; background:rgba(255,255,255,0.93);
    padding:32px 20px 30px 20px;
    border-radius:24px;
    box-shadow:0 10px 32px rgba(30,60,170,0.13);
}
h1 {
    text-align:center; margin-bottom:5px; color: #1976d2;
    letter-spacing:2px;font-size:42px;
    background: linear-gradient(95deg,#2adfc4 30%,#0099ff 80%);
    background-clip: text; -webkit-background-clip: text;
    color: transparent; -webkit-text-fill-color: transparent;
}
.subtitle {
    text-align:center; color:#166;margin-bottom:24px;
    font-size:20px; font-weight:500;
}
.search-box {
    width:99%; max-width:480px;margin:22px auto 0 auto;display:block;
    padding:18px; font-size:25px; border-radius:50px; border:2.5px solid #19bcc4;
    text-align:center;
}
.results {margin-top:26px; max-height:500px; overflow-y:auto;}

.voter-item {
    background:linear-gradient(95deg,#fff 86%,#e1f8f4 100%);
    padding:19px 16px; border-right:7px solid #27e88b;
    border-radius:19px;
    margin:14px 0; cursor:pointer;
    transition:.23s;
}
.voter-name {font-size:23px; font-weight:bold; color:#1a3f58;}
.voter-serial {font-size:27px; font-weight:900; color:#e50c41;padding-top:4px;}

.modal {
    display:none; position:fixed; left:0; top:0; width:100%; height:100%;
    background:rgba(30,43,58,0.92);
    justify-content:center; align-items:center;
    z-index:10000;
}
.card {
    width:370px; background:#fff;
    border-radius:25px;
    padding:20px;
    position:relative;
}
.big-serial {font-size:45px;color:#dc143c;font-weight:900;text-align:center;margin:20px 0;}

.close-btn {
    position:absolute;top:10px;left:10px;
    background:#ffdddd;
    border:none; border-radius:50%; padding:10px;font-size:22px;
    cursor:pointer;
}

</style>
</head>

<body>

<div class="container">

    <h1>انتخابات 2025</h1>
    <p class="subtitle">ابحث بالاسم أو الرقم – النتائج فورية</p>

    <input type="text" id="searchBox" class="search-box"
           placeholder="ابحث هنا..."
           onkeyup="search()">

    <div id="results" class="results"></div>

</div>



<!-- نافذة البطاقة -->
<div id="modal" class="modal" onclick="this.style.display='none'">
    <div class="card" onclick="event.stopPropagation()">
        <button class="close-btn" onclick="document.getElementById('modal').style.display='none'">×</button>

        <h2 id="modalName"></h2>
        <div class="big-serial" id="modalSerial"></div>

        <button onclick="correctName()" style="
            padding:12px; font-size:20px; width:100%; border:none;
            border-radius:15px; background:#1976d2; color:white; cursor:pointer;">
            تعديل الاسم لهذه النسخة
        </button>
    </div>
</div>




<script>
/* ——————————————————————————————————————
   تحميل البيانات من ملف خارجي (كما هو)
—————————————————————————————————————— */
const AUTOLOAD_URL =
 "https://raw.githubusercontent.com/mohamednasr5/ahm/refs/heads/main/00.txt";

window.addEventListener('DOMContentLoaded', () => {
    fetch(AUTOLOAD_URL)
    .then(r=>r.text())
    .then(t=>{
        document.body.insertAdjacentHTML("beforeend", `
        <textarea id="hiddenDB" style="display:none">${t}</textarea>
        `);
        loadData();
    });
});


/* ——————————————————————————————————————
   تجهيز المتغيرات الأساسية
—————————————————————————————————————— */
let voters = [];
let currentSelected = null;


/* ——————————————————————————————————————
   تطبيع الأسماء
—————————————————————————————————————— */
function fixNumbers(str) {
    const map = {"٠":"0","١":"1","٢":"2","٣":"3","٤":"4","٥":"5","٦":"6","٧":"7","٨":"8","٩":"9"};
    return str.replace(/[٠-٩]/g, d => map[d]);
}
function normalizeName(str) {
    return str.replace(/[يى]/g, "ى").replace(/\s+/g, " ").trim();
}
function tokenize(str) {
    return normalizeName(str).split(" ").filter(Boolean);
}


/* ——————————————————————————————————————
   استخراج الرقم والاسم من كل سطر
—————————————————————————————————————— */
function extractNumberName(line) {

    line = fixNumbers(line).trim();
    if (!line) return [];

    let regex = /(\d{1,5})\s+([\u0600-\u06FF\s]+)/;

    let m = line.match(regex);
    if (!m) return [];

    return [{
        number: m[1],
        name: m[2].trim()
    }];
}


/* ——————————————————————————————————————
       تحميل البيانات داخل voters مع tokens
—————————————————————————————————————— */
function loadData() {
    const text = document.getElementById("hiddenDB").value.trim();
    const lines = text.split(/\n/);

    voters = [];

    lines.forEach(line => {
        const recs = extractNumberName(line);
        recs.forEach(r => {
            r.tokens = tokenize(r.name);
            voters.push(r);
        });
    });
}


/* ——————————————————————————————————————
         البحث الجديد (مطابقة 3 كلمات)
—————————————————————————————————————— */
function search() {

    let q = document.getElementById("searchBox").value.trim();
    let res = document.getElementById("results");
    res.innerHTML = "";

    if (!q) return;

    const qTokens = tokenize(q);

    if (qTokens.length < 3) return;

    const results = [];

    for (const v of voters) {
        let matchCount = 0;

        for (const qWord of qTokens) {
            for (const nameWord of v.tokens) {
                if (nameWord.includes(qWord) || qWord.includes(nameWord)) {
                    matchCount++;
                    break;
                }
            }
        }

        if (matchCount >= 3) {
            results.push(v);
        }
    }

    results.slice(0, 30).forEach(v => {
        const div = document.createElement("div");
        div.className = "voter-item";
        div.innerHTML = `
            <div class="voter-name">${v.name}</div>
            <div class="voter-serial">رقم الكشف: ${v.number}</div>
        `;
        div.onclick = () => showCard(v);
        res.appendChild(div);
    });
}


/* ——————————————————————————————————————
          عرض البطاقة + حفظ المختار
—————————————————————————————————————— */
function showCard(v) {
    currentSelected = v;

    document.getElementById("modalName").textContent = v.name;
    document.getElementById("modalSerial").textContent = v.number;

    document.getElementById("modal").style.display = "flex";
}


/* ——————————————————————————————————————
     ✨ تعديل الاسم تلقائيًا بالاسم الصحيح
—————————————————————————————————————— */
function correctName() {

    if (!currentSelected) return;

    const newName = normalizeName(document.getElementById("searchBox").value.trim());

    if (!newName || newName.split(" ").length < 3) {
        alert("يجب كتابة 3 كلمات على الأقل في خانة البحث!");
        return;
    }

    // تعديل الاسم داخل قاعدة البيانات في الذاكرة
    currentSelected.name = newName;
    currentSelected.tokens = tokenize(newName);

    // تحديث في البطاقة
    document.getElementById("modalName").textContent = newName;

    alert("تم تصحيح الاسم في قاعدة البيانات مؤقتًا بنجاح ✔️");

    search();
}

</script>

</body>
</html>
